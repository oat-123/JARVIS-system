# การแก้ไขปัญหาประวัติถวายรายงาน

## ปัญหาที่พบ
ในหน้าโปรไฟล์ของโมดูล 433 การแสดงประวัติถวายรายงานแสดงเฉพาะข้อมูลจากคอลัมน์ "ถวายรายงาน" เท่านั้น ไม่รวมข้อมูลจากคอลัมน์อื่นๆ ที่เกี่ยวข้อง เช่น "น.กำกับยาม" และ "วันที่" ตามที่ปรากฏใน Google Sheets

## การแก้ไขที่ทำ

### 1. แก้ไข API Route (`app/api/sheets/433/route.ts`)
- เพิ่มการดึงข้อมูลจากคอลัมน์ "น.กำกับยาม" และ "วันที่"
- รวมข้อมูลเหล่านี้ใน person object ที่ส่งกลับ

### 2. แก้ไขฟังก์ชัน normalizePerson (`components/modules/duty-433.tsx`)
- ปรับปรุงฟังก์ชัน `addReport` ให้รับพารามิเตอร์ `dutyOfficer`
- เพิ่มการดึงข้อมูลจากคอลัมน์ "น.กำกับยาม" และ "วันที่"
- สร้างฟังก์ชัน `formattedReportHistory` ที่รวมข้อมูลทั้งหมดในรูปแบบที่ถูกต้อง

### 3. แก้ไขการแสดงผลในหน้า Detail
- ปรับปรุงการแสดงผลประวัติถวายรายงานให้ใช้ `formattedText`
- เพิ่ม fallback สำหรับข้อมูลเก่า

## รูปแบบการแสดงผลใหม่
แทนที่จะแสดงแค่ "HMSV" จะแสดงเป็น:
**"HMSV คู่ พ.ต.มัฆวาน สนิทชน เมื่อ ๒๓ ส.ค. ๖๘"**

## ข้อมูลที่รวม
- **ถวายรายงาน**: รหัสหรือชื่อรายงาน (เช่น HMSV)
- **คู่พี่นายทหาร**: ข้อมูลคู่พี่ (ถ้ามี)
- **น.กำกับยาม**: ชื่อนายทหารกำกับยาม (เช่น พ.ต.มัฆวาน สนิทชน)
- **วันที่**: วันที่ถวายรายงาน (เช่น ๒๓ ส.ค. ๖๘)

## การทดสอบ
1. เข้าไปที่โมดูล 433 (เฉพาะผู้ใช้ oat)
2. คลิกดูรายละเอียดของบุคคลที่มีประวัติถวายรายงาน
3. ตรวจสอบว่าประวัติถวายรายงานแสดงในรูปแบบที่ถูกต้อง

## ไฟล์ที่แก้ไข
- `app/api/sheets/433/route.ts`
- `components/modules/duty-433.tsx`

## สถานะ
✅ แก้ไขเสร็จสิ้น - ประวัติถวายรายงานจะแสดงในรูปแบบที่ถูกต้องตามข้อมูลใน Google Sheets
