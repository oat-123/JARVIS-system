# การแก้ไขปัญหาโปรไฟล์ในระบบเวร 433

## ปัญหาที่พบ
เมื่อเข้าดูโปรไฟล์จากหน้า overview กับหน้ารายชื่อทั้งหมด ข้อมูลที่แสดงไม่ตรงกัน โดยเฉพาะในส่วน "ประวัติเข้า433" ที่ควรแสดงแค่ "ครั้งที่ 1 เมื่อ ๒๓ ส.ค. ๖๘ พระอินทร์" แต่กลับแสดงข้อมูลที่ไม่ถูกต้อง

## สาเหตุของปัญหา
1. **การประมวลผลข้อมูลที่แตกต่างกัน**: ข้อมูลที่แสดงในหน้า overview และหน้ารายชื่อทั้งหมดถูกประมวลผลด้วยฟังก์ชันที่แตกต่างกัน
2. **การแสดงผลในคอมโพเนนต์เดียวกัน**: การแสดงรายละเอียดโปรไฟล์อยู่ในคอมโพเนนต์เดียวกับหน้าหลัก ทำให้เกิดความสับสนในการจัดการข้อมูล
3. **ข้อมูลไม่ตรงกับ Google Sheets**: ข้อมูลที่แสดงในหน้าโปรไฟล์ไม่ตรงกับข้อมูลจริงใน Google Sheets

## วิธีแก้ไข
### 1. สร้างหน้าโปรไฟล์แยกต่างหาก
- ไฟล์ `components/profile-detail.tsx` - หน้าแสดงรายละเอียดโปรไฟล์ที่แยกออกมาต่างหาก
- แสดงข้อมูลอย่างถูกต้องและสอดคล้องกัน
- **แก้ไขการแสดงผล "ประวัติเข้า433"** ให้ตรงกับข้อมูลใน Google Sheets (คอลัมภ์ Q-T: "433 ครั้งที่ 1" ถึง "433 ครั้งที่ 4")
- **แก้ไขการแสดงผล "ประวัติถวายรายงาน"** ให้แสดงเป็น "HMSV คู่ พ.ต.มัฆวาน สนิทชน เมื่อ ๒๓ ส.ค. ๖๘" ตามข้อมูลในคอลัมภ์ Z, AA, AB

### 2. แก้ไขไฟล์ `duty-433.tsx`
- นำเข้า `ProfileDetail` component
- แทนที่ส่วนแสดงรายละเอียดเดิมด้วยหน้าโปรไฟล์แยกต่างหาก
- ลบโค้ดที่แสดงรายละเอียดเดิมออก
- **แก้ไขการคำนวณสถิติ** ให้แสดงจำนวนครั้งที่เข้า 433 แทน "สถิติโดนยอด"
- **เพิ่มการกรองหน้าที่** ให้รวมคอลัมภ์ "ธุรการ ฝอ." และ "ธุรการ" ตามที่ต้องการ

### 3. แก้ไขการแสดงผลสถิติ
- **สถิติในหน้ารายชื่อทั้งหมด**: แสดงจำนวนครั้งที่เข้า 433 แทน "สถิติโดนยอด"
- **สถิติในหน้า overview**: คำนวณจำนวนคนตามข้อมูลจริงใน Google Sheets
- **สถิติในตาราง Top 5**: แสดงจำนวนครั้งที่เข้า 433 ตามข้อมูลจริง

## ไฟล์ที่เปลี่ยนแปลง
1. **`components/profile-detail.tsx`** (ใหม่) - หน้าแสดงรายละเอียดโปรไฟล์
2. **`components/modules/duty-433.tsx`** (แก้ไข) - ใช้หน้าโปรไฟล์แยกต่างหากและแก้ไขการคำนวณสถิติ

## การแก้ไขเฉพาะเจาะจง

### ประวัติเข้า433
- **ก่อน**: แสดงข้อมูลที่ไม่ตรงกับ Google Sheets
- **หลัง**: แสดงข้อมูลจากคอลัมภ์ "433 ครั้งที่ 1" ถึง "433 ครั้งที่ 4" ใน Google Sheets
- **ตัวอย่าง**: "ครั้งที่ 1 เมื่อ ๒๓ ส.ค. ๖๘ พระอินทร์"

### ประวัติถวายรายงาน
- **ก่อน**: แสดงข้อมูลแบบเดิม
- **หลัง**: แสดงข้อมูลรวมจากคอลัมภ์ "ถวายรายงาน", "น.กำกับยาม", และ "วันที่"
- **ตัวอย่าง**: "HMSV คู่ พ.ต.มัฆวาน สนิทชน เมื่อ ๒๓ ส.ค. ๖๘"

### สถิติได้รับหน้าที่พิเศษ
- **ก่อน**: แสดง "สถิติโดนยอด" จากฐานข้อมูล
- **หลัง**: แสดงจำนวนครั้งที่เข้า 433 ตามข้อมูลจริงใน Google Sheets
- **ใช้สำหรับ**: แสดงผลในหน้ารายชื่อทั้งหมดและใช้ในการกรองข้อมูล

### การกรองหน้าที่
- **เพิ่ม**: คอลัมภ์ "ธุรการ ฝอ." และ "ธุรการ" ในตัวเลือกการกรอง
- **ใช้สำหรับ**: กรองข้อมูลในหน้ารายชื่อทั้งหมดตามที่ต้องการ

## ประโยชน์ที่ได้รับ
1. **ข้อมูลถูกต้องและสอดคล้องกัน**: ไม่ว่าจะเข้าจากหน้าไหน ข้อมูลจะแสดงผลเหมือนกันและตรงกับ Google Sheets
2. **โค้ดสะอาดและง่ายต่อการบำรุงรักษา**: แยกหน้าที่แสดงรายละเอียดออกมาต่างหาก
3. **ประสิทธิภาพดีขึ้น**: ไม่ต้องประมวลผลข้อมูลซ้ำในหน้าหลัก
4. **ง่ายต่อการแก้ไขในอนาคต**: หากต้องการแก้ไขการแสดงผลโปรไฟล์ สามารถแก้ไขได้ในไฟล์เดียว
5. **สถิติถูกต้อง**: แสดงจำนวนครั้งที่เข้า 433 ตามข้อมูลจริง ไม่ใช่ข้อมูลที่ผิดพลาด

## การใช้งาน
เมื่อคลิกที่รายชื่อใดๆ ในระบบ (ไม่ว่าจะจากหน้า overview หรือหน้ารายชื่อทั้งหมด) จะถูกนำไปยังหน้าโปรไฟล์แยกต่างหากที่แสดงข้อมูลอย่างถูกต้องและสอดคล้องกันกับ Google Sheets

## หมายเหตุ
- การแก้ไขนี้ไม่กระทบต่อฟังก์ชันการทำงานอื่นๆ ของระบบ
- ข้อมูลที่แสดงจะถูกต้องตามที่กำหนดไว้ใน Google Sheets
- UI และ UX ยังคงเหมือนเดิม แต่ข้อมูลจะถูกต้องมากขึ้น
- สถิติจะแสดงจำนวนครั้งที่เข้า 433 ตามข้อมูลจริง ไม่ใช่ข้อมูลที่ผิดพลาด
